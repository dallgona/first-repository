{"cells":[{"cell_type":"code","source":["import os\n","import pandas as pd\n","import requests\n","from bs4 import BeautifulSoup\n","from urllib.parse import quote, urljoin\n","import time\n","\n","\n","def setup_colab():\n","    \"\"\"Google Drive를 마운트하고 저장 경로를 설정\"\"\"\n","    from google.colab import drive\n","    drive.mount('/content/drive')\n","    save_path = \"/content/drive/MyDrive/YTN_News\"\n","    os.makedirs(save_path, exist_ok=True)\n","    return save_path\n","\n","def get_news_links(search, start_date, end_date):\n","    \"\"\"검색 결과 페이지에서 뉴스 기사 링크를 가져옴\"\"\"\n","    search_encoded = quote(search)\n","    base_url = \"https://www.ytn.co.kr/search/index/?q=\"\n","    news_links = []\n","    for date in pd.date_range(start=start_date, end=end_date):\n","        url = f\"{base_url}{search_encoded}&sdate={date.strftime('%Y%m%d')}&edate={date.strftime('%Y%m%d')}\"\n","        for _ in range(3):  # Retry up to 3 times\n","            try:\n","                response = requests.get(url, headers={\"User-Agent\": \"Mozilla/5.0\"})\n","                response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)\n","                break  # Exit the retry loop if successful\n","            except (requests.exceptions.RequestException, requests.exceptions.HTTPError) as e:\n","                print(f\"Error fetching URL: {url}, retrying in 5 seconds... Error: {e}\")\n","                time.sleep(5)  # Wait for 5 seconds before retrying\n","        else:\n","            print(f\"Failed to fetch URL after multiple retries: {url}\")\n","            continue  # Skip to the next date if all retries fail\n","\n","        soup = BeautifulSoup(response.text, \"html.parser\")\n","        links = [urljoin(\"https://www.ytn.co.kr\", a['href']) for a in soup.select(\".search_news_list a[href]\")]\n","        news_links.extend(links)\n","    return list(set(news_links))\n","\n","def fetch_news_content(url):\n","    \"\"\"기사의 제목, 날짜, 본문을 가져옴 (디버깅용 print 추가)\"\"\"\n","    response = requests.get(url, headers={\"User-Agent\": \"Mozilla/5.0\"})\n","    soup = BeautifulSoup(response.text, \"html.parser\")\n","\n","    title_element = soup.select_one(\"h2.news_title span\")\n","    title = title_element.get_text(strip=True) if title_element else \"(제목 없음)\"\n","\n","    date_element = soup.select_one(\"div.date\")\n","    date = date_element.get_text(strip=True) if date_element else \"(날짜 없음)\"\n","\n","    content_elements = soup.select(\"div#CmAdContent.paragraph span\")\n","    content = \" \".join([p.get_text(strip=True) for p in content_elements]) if content_elements else \"(내용 없음)\"\n","\n","    print(f\"[DEBUG] URL: {url}\")\n","    print(f\"[DEBUG] Title: {title}\")\n","    print(f\"[DEBUG] Date: {date}\")\n","    print(f\"[DEBUG] Content Length: {len(content)}\")\n","\n","    return date, title, url, content\n","\n","def main():\n","    \"\"\"메인 함수\"\"\"\n","    search = input(\"검색어를 입력하세요: \")\n","    start_date = input(\"검색 시작 날짜 (YYYYMMDD): \")\n","    end_date = input(\"검색 종료 날짜 (YYYYMMDD): \")\n","    save_path = setup_colab()\n","\n","    news_links = get_news_links(search, start_date, end_date)\n","    news_data = [fetch_news_content(url) for url in news_links]\n","\n","    df = pd.DataFrame(news_data, columns=['date', 'title', 'link', 'content'])\n","    df.drop_duplicates(subset=['title', 'content'], inplace=True)\n","    file_name = f\"{search}_{start_date}_{end_date}.csv\"\n","    df.to_csv(os.path.join(save_path, file_name), index=False, encoding='utf-8-sig')\n","    print(f\"파일이 저장되었습니다: {save_path}/{file_name}\")\n","\n","if __name__ == \"__main__\":\n","    main()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"fTYWoqkZ8r5Q","outputId":"49958931-872f-4221-e1b5-4448751e3ab2","executionInfo":{"status":"ok","timestamp":1739864612795,"user_tz":-540,"elapsed":207248,"user":{"displayName":"김진형","userId":"08776139044149773662"}}},"id":"fTYWoqkZ8r5Q","execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["검색어를 입력하세요: 손흥민\n","검색 시작 날짜 (YYYYMMDD): 20250101\n","검색 종료 날짜 (YYYYMMDD): 20250115\n","Mounted at /content/drive\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0104_202502130540557348\n","[DEBUG] Title: 토트넘 간 찰스3세 \"팀 잘 되나\"...손흥민 \"어렵지만 노력 중\"\n","[DEBUG] Date: 2025.02.13. 오전 05:40.\n","[DEBUG] Content Length: 476\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0134_202501311339446791\n","[DEBUG] Title: 손흥민 클래스 제대로 보여줬다...'데뷔골' 유스도 \"나의 우상\" [지금이뉴스]\n","[DEBUG] Date: 2025.01.31. 오후 1:39.\n","[DEBUG] Content Length: 625\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502101056519680\n","[DEBUG] Title: 손흥민 골 침묵...토트넘, FA컵 16강 진출도 실패\n","[DEBUG] Date: 2025.02.10. 오전 10:56.\n","[DEBUG] Content Length: 436\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502030840137409\n","[DEBUG] Title: 손흥민 4연패 탈출 뒤 \"이제 리그컵 준결승 집중\"\n","[DEBUG] Date: 2025.02.03. 오전 08:40.\n","[DEBUG] Content Length: 416\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501240936424049\n","[DEBUG] Title: '손흥민 2골' 토트넘, 유로파리그 16강 성큼\n","[DEBUG] Date: 2025.01.24. 오전 09:36.\n","[DEBUG] Content Length: 967\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502030201463332\n","[DEBUG] Title: 손흥민, 7호 도움·자책골 유도...토트넘 4연패 탈출\n","[DEBUG] Date: 2025.02.03. 오전 02:01.\n","[DEBUG] Content Length: 393\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501311559577925\n","[DEBUG] Title: 손흥민, 전반만 뛰고도 강렬한 존재감...토트넘, 유로파 16강 직행\n","[DEBUG] Date: 2025.01.31. 오후 3:59.\n","[DEBUG] Content Length: 973\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502171117521389\n","[DEBUG] Title: 손흥민 공격 포인트 없이도 '최고 평점'...토트넘 모처럼 2연승\n","[DEBUG] Date: 2025.02.17. 오전 11:17.\n","[DEBUG] Content Length: 923\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502071543035410\n","[DEBUG] Title: 손흥민 우승 기회 또 무산...토트넘 리그컵 결승 좌절\n","[DEBUG] Date: 2025.02.07. 오후 3:43.\n","[DEBUG] Content Length: 314\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501310736504340\n","[DEBUG] Title: 손흥민 45분...토트넘, 유로파리그 16강 직행\n","[DEBUG] Date: 2025.01.31. 오전 07:36.\n","[DEBUG] Content Length: 482\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502171319057336\n","[DEBUG] Title: 손흥민 공격 포인트 없이도 '최고 평점'...토트넘 모처럼 2연승\n","[DEBUG] Date: 2025.02.17. 오후 1:19.\n","[DEBUG] Content Length: 923\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501260016577403\n","[DEBUG] Title: 토트넘 일으켜 세운 손흥민...양민혁 오늘 데뷔전?\n","[DEBUG] Date: 2025.01.26. 오전 00:16.\n","[DEBUG] Content Length: 856\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0134_202502131346266340\n","[DEBUG] Title: 찰스3세 만난 손흥민, \"팀 잘 되고 있나\" 질문 받자... [지금이뉴스]\n","[DEBUG] Date: 2025.02.13. 오후 1:46.\n","[DEBUG] Content Length: 469\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501270853553476\n","[DEBUG] Title: '손흥민 침묵' 토트넘, 7연패 중이던 레스터시티에 지며 4연패 수렁\n","[DEBUG] Date: 2025.01.27. 오전 08:53.\n","[DEBUG] Content Length: 372\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501300000283746\n","[DEBUG] Title: 손흥민 '질주'·양민혁 '공간'...둘은 이게 다르다\n","[DEBUG] Date: 2025.01.30. 오전 00:00.\n","[DEBUG] Content Length: 924\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501251218140586\n","[DEBUG] Title: 토트넘 일으켜 세운 손흥민...양민혁 내일 데뷔전?\n","[DEBUG] Date: 2025.01.25. 오후 12:18.\n","[DEBUG] Content Length: 874\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502030532031821\n","[DEBUG] Title: 손흥민, 7호 도움·자책골 유도...토트넘 4연패 탈출\n","[DEBUG] Date: 2025.02.03. 오전 05:32.\n","[DEBUG] Content Length: 393\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202501271103035179\n","[DEBUG] Title: 침묵한 손흥민...토트넘은 리그 4연패 '수렁'\n","[DEBUG] Date: 2025.01.27. 오전 11:03.\n","[DEBUG] Content Length: 833\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502071341236375\n","[DEBUG] Title: 손흥민 우승 기회 또 무산...토트넘 리그컵 결승 좌절\n","[DEBUG] Date: 2025.02.07. 오후 1:41.\n","[DEBUG] Content Length: 484\n","[DEBUG] URL: https://www.ytn.co.kr/_ln/0107_202502170652150832\n","[DEBUG] Title: '손흥민 결승 골 기여' 토트넘 2연승·12위 도약...황희찬은 결장\n","[DEBUG] Date: 2025.02.17. 오전 06:52.\n","[DEBUG] Content Length: 356\n","파일이 저장되었습니다: /content/drive/MyDrive/YTN_News/손흥민_20250101_20250115.csv\n"]}]}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.7"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}